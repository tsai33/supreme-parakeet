
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥é¤æ¡¶åˆ†é…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f9ff;
        }
        
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .number-box {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .spin-button {
            transition: all 0.2s ease;
        }
        
        .spin-button:hover {
            transform: scale(1.05);
        }
        
        .spin-button:active {
            transform: scale(0.95);
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }
        
        .number-input {
            width: 100%;
            text-align: center;
        }
        
        .number-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .number-btn:hover {
            transform: scale(1.1);
        }
        
        .number-btn.selected {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
        }
        
        .number-btn.used {
            background-color: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }
        
        .day-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .day-btn {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #e5e7eb;
            color: #4b5563;
        }
        
        .day-btn:hover {
            background-color: #d1d5db;
        }
        
        .day-btn.active {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-800 mb-2">æ¯æ—¥é¤æ¡¶åˆ†é…</h1>
            <p class="text-gray-600">ä»Šå¤©ç”±å“ªäº›åŒå­¸è² è²¬å‘¢ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ä¾†å®‰æ’ï¼</p>
        </header>
        
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-wrap justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-blue-700">ä»Šæ—¥å€¼æ—¥ç”Ÿ</h2>
                <div class="flex space-x-2">
                    <button id="resetBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">é‡ç½®</button>
                    <button id="spinAllBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">ä¸€éµæŠ½é¸å…¨éƒ¨</button>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="font-medium text-gray-700 mb-2">å¯é¸å­¸ç”Ÿè™Ÿç¢¼ï¼š</h3>
                <div class="number-selector flex flex-wrap gap-2 mb-4" id="numberSelector">
                    <!-- è™Ÿç¢¼æŒ‰éˆ•å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500">é»æ“Šè™Ÿç¢¼é¸æ“‡æˆ–å–æ¶ˆé¸æ“‡å­¸ç”Ÿ</p>
                    <div class="flex space-x-2">
                        <span id="selectedCount" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-md">å·²é¸: 0/12</span>
                        <button id="clearSelectionBtn" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition">æ¸…é™¤é¸æ“‡</button>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- é£¯ -->
                <div class="task-card bg-yellow-50 rounded-lg p-5 border-l-4 border-yellow-400">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-yellow-700">
                            <span class="inline-block mr-2">ğŸš</span>é£¯
                        </h3>
                        <button class="spin-button px-3 py-1 bg-yellow-500 text-white rounded-md hover:bg-yellow-600" data-task="rice">æŠ½é¸</button>
                    </div>
                    <div class="selected-students grid grid-cols-2 gap-2" data-task="rice">
                        <div class="number-box bg-yellow-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-yellow-800">?</span>
                        </div>
                        <div class="number-box bg-yellow-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-yellow-800">?</span>
                        </div>
                    </div>
                </div>
                
                <!-- èœ1 -->
                <div class="task-card bg-green-50 rounded-lg p-5 border-l-4 border-green-400">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-green-700">
                            <span class="inline-block mr-2">ğŸ¥¬</span>èœ (ä¸€)
                        </h3>
                        <button class="spin-button px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600" data-task="veg1">æŠ½é¸</button>
                    </div>
                    <div class="selected-students grid grid-cols-2 gap-2" data-task="veg1">
                        <div class="number-box bg-green-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-green-800">?</span>
                        </div>
                        <div class="number-box bg-green-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-green-800">?</span>
                        </div>
                    </div>
                </div>
                
                <!-- èœ2 -->
                <div class="task-card bg-emerald-50 rounded-lg p-5 border-l-4 border-emerald-400">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-emerald-700">
                            <span class="inline-block mr-2">ğŸ¥¦</span>èœ (äºŒ)
                        </h3>
                        <button class="spin-button px-3 py-1 bg-emerald-500 text-white rounded-md hover:bg-emerald-600" data-task="veg2">æŠ½é¸</button>
                    </div>
                    <div class="selected-students grid grid-cols-2 gap-2" data-task="veg2">
                        <div class="number-box bg-emerald-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-emerald-800">?</span>
                        </div>
                        <div class="number-box bg-emerald-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-emerald-800">?</span>
                        </div>
                    </div>
                </div>
                
                <!-- èœ3 -->
                <div class="task-card bg-teal-50 rounded-lg p-5 border-l-4 border-teal-400" id="veg3Card">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-teal-700">
                            <span class="inline-block mr-2">ğŸ¥—</span>èœ (ä¸‰)
                        </h3>
                        <button class="spin-button px-3 py-1 bg-teal-500 text-white rounded-md hover:bg-teal-600" data-task="veg3">æŠ½é¸</button>
                    </div>
                    <div class="selected-students grid grid-cols-2 gap-2" data-task="veg3">
                        <div class="number-box bg-teal-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-teal-800">?</span>
                        </div>
                        <div class="number-box bg-teal-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-teal-800">?</span>
                        </div>
                    </div>
                </div>
                
                <!-- æ¹¯ -->
                <div class="task-card bg-red-50 rounded-lg p-5 border-l-4 border-red-400">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-red-700">
                            <span class="inline-block mr-2">ğŸ²</span>æ¹¯
                        </h3>
                        <button class="spin-button px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600" data-task="soup">æŠ½é¸</button>
                    </div>
                    <div class="selected-students grid grid-cols-2 gap-2" data-task="soup">
                        <div class="number-box bg-red-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-red-800">?</span>
                        </div>
                        <div class="number-box bg-red-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-red-800">?</span>
                        </div>
                    </div>
                </div>
                
                <!-- æ°´æœ -->
                <div class="task-card bg-purple-50 rounded-lg p-5 border-l-4 border-purple-400">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-bold text-purple-700">
                            <span class="inline-block mr-2">ğŸ</span>æ°´æœ
                        </h3>
                        <button class="spin-button px-3 py-1 bg-purple-500 text-white rounded-md hover:bg-purple-600" data-task="fruit">æŠ½é¸</button>
                    </div>
                    <div class="selected-students" data-task="fruit" id="fruitTaskContainer">
                        <div class="number-box bg-purple-100 rounded p-2 text-center">
                            <span class="task-number text-lg font-medium text-purple-800">?</span>
                        </div>
                        <div class="number-box bg-purple-100 rounded p-2 text-center second-fruit">
                            <span class="task-number text-lg font-medium text-purple-800">?</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-blue-700 mb-4">æœ¬é€±å€¼æ—¥è¡¨</h2>
            
            <!-- æ˜ŸæœŸé¸æ“‡å™¨ -->
            <div class="day-selector mb-4">
                <div class="day-btn" data-day="monday">é€±ä¸€</div>
                <div class="day-btn" data-day="tuesday">é€±äºŒ</div>
                <div class="day-btn" data-day="wednesday">é€±ä¸‰</div>
                <div class="day-btn" data-day="thursday">é€±å››</div>
                <div class="day-btn" data-day="friday">é€±äº”</div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white">
                    <thead>
                        <tr class="bg-blue-100">
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é …ç›®</th>
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é€±ä¸€</th>
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é€±äºŒ</th>
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é€±ä¸‰</th>
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é€±å››</th>
                            <th class="py-2 px-4 border-b border-gray-200 text-left">é€±äº”</th>
                        </tr>
                    </thead>
                    <tbody id="weeklyTable">
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸš é£¯</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸ¥¬ èœ (ä¸€)</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸ¥¦ èœ (äºŒ)</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸ¥— èœ (ä¸‰)</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸ² æ¹¯</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                        <tr>
                            <td class="py-2 px-4 border-b border-gray-200 font-medium">ğŸ æ°´æœ</td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                            <td class="py-2 px-4 border-b border-gray-200"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="saveWeeklyBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">å„²å­˜æœ¬é€±å€¼æ—¥è¡¨</button>
            </div>
        </div>
        
        <!-- å­¸ç”Ÿé¸æ“‡å°è©±æ¡† -->
        <div id="studentSelectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 max-w-md w-full">
                <h3 class="text-xl font-bold mb-4">é¸æ“‡å­¸ç”Ÿè™Ÿç¢¼</h3>
                <div class="number-selector-modal flex flex-wrap gap-2 mb-4">
                    <!-- è™Ÿç¢¼æŒ‰éˆ•å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
                <div class="flex justify-end space-x-2">
                    <button id="cancelSelectBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">å–æ¶ˆ</button>
                    <button id="confirmSelectBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">ç¢ºèª</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const totalStudents = 27;
            let requiredStudents = 12; // é è¨­éœ€è¦é¸æ“‡12å€‹å­¸ç”Ÿè™Ÿç¢¼
            const availableNumbers = Array.from({length: totalStudents}, (_, i) => i + 1);
            const includedStudents = new Set(); // è¢«é¸ä¸­çš„å­¸ç”Ÿè™Ÿç¢¼
            const assignedStudents = new Set(); // å·²åˆ†é…çš„å­¸ç”Ÿè™Ÿç¢¼
            const weeklyData = {
                monday: {}, tuesday: {}, wednesday: {}, thursday: {}, friday: {}
            };
            const dayMapping = {
                0: 'monday',
                1: 'tuesday',
                2: 'wednesday',
                3: 'thursday',
                4: 'friday'
            };
            
            // ç²å–ä»Šå¤©æ˜¯æ˜ŸæœŸå¹¾
            const today = new Date().getDay() - 1; // 0 = æ˜ŸæœŸä¸€, 4 = æ˜ŸæœŸäº”
            let currentDay = today >= 0 && today <= 4 ? dayMapping[today] : 'monday';
            
            // ç”Ÿæˆè™Ÿç¢¼é¸æ“‡å™¨
            const numberSelector = document.getElementById('numberSelector');
            generateNumberButtons(numberSelector);
            
            // åˆå§‹åŒ–æ˜ŸæœŸé¸æ“‡å™¨
            initDaySelector();
            
            // æ›´æ–°å·²é¸æ“‡æ•¸é‡
            function updateSelectedCount() {
                const countElement = document.getElementById('selectedCount');
                countElement.textContent = `å·²é¸: ${includedStudents.size}/${requiredStudents}`;
                
                if (includedStudents.size === requiredStudents) {
                    countElement.classList.remove('bg-blue-100', 'text-blue-800');
                    countElement.classList.add('bg-green-100', 'text-green-800');
                } else {
                    countElement.classList.remove('bg-green-100', 'text-green-800');
                    countElement.classList.add('bg-blue-100', 'text-blue-800');
                }
            }
            
            // åˆå§‹åŒ–æ˜ŸæœŸé¸æ“‡å™¨
            function initDaySelector() {
                const dayButtons = document.querySelectorAll('.day-btn');
                
                // è¨­ç½®åˆå§‹é¸ä¸­ç‹€æ…‹
                dayButtons.forEach(btn => {
                    const day = btn.getAttribute('data-day');
                    if (day === currentDay) {
                        btn.classList.add('active');
                    }
                    
                    btn.addEventListener('click', function() {
                        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„é¸ä¸­ç‹€æ…‹
                        dayButtons.forEach(b => b.classList.remove('active'));
                        
                        // è¨­ç½®ç•¶å‰æŒ‰éˆ•ç‚ºé¸ä¸­ç‹€æ…‹
                        this.classList.add('active');
                        
                        // æ›´æ–°ç•¶å‰é¸ä¸­çš„æ˜ŸæœŸ
                        currentDay = this.getAttribute('data-day');
                        
                        // æ›´æ–°è¡¨æ ¼é«˜äº®
                        updateWeeklyTable();
                        
                        // æ›´æ–°ç•¶å‰åˆ†é…çš„å­¸ç”Ÿ
                        updateCurrentDayAssignments();
                        
                        // æ›´æ–°æ°´æœä»»å‹™é¡¯ç¤ºå’Œèœ(ä¸‰)ä»»å‹™é¡¯ç¤º
                        updateTasksDisplay();
                        
                        // æ›´æ–°æ‰€éœ€å­¸ç”Ÿæ•¸é‡
                        updateRequiredStudents();
                    });
                });
                
                // åˆå§‹åŒ–æ™‚æ›´æ–°ä»»å‹™é¡¯ç¤ºå’Œæ‰€éœ€å­¸ç”Ÿæ•¸é‡
                updateTasksDisplay();
                updateRequiredStudents();
            }
            
            // æ›´æ–°æ‰€éœ€å­¸ç”Ÿæ•¸é‡
            function updateRequiredStudents() {
                if (currentDay === 'monday') {
                    requiredStudents = 11; // é€±ä¸€åªéœ€è¦11å€‹å­¸ç”Ÿ
                } else if (currentDay === 'wednesday') {
                    requiredStudents = 10; // é€±ä¸‰åªéœ€è¦10å€‹å­¸ç”Ÿ
                } else if (currentDay === 'friday') {
                    requiredStudents = 11; // é€±äº”åªéœ€è¦11å€‹å­¸ç”Ÿ
                } else {
                    requiredStudents = 12; // å…¶ä»–æ—¥å­éœ€è¦12å€‹å­¸ç”Ÿ
                }
                updateSelectedCount();
            }
            
            // æ›´æ–°æ°´æœä»»å‹™å’Œèœ(ä¸‰)ä»»å‹™é¡¯ç¤º
            function updateTasksDisplay() {
                const fruitContainer = document.getElementById('fruitTaskContainer');
                const secondFruit = fruitContainer.querySelector('.second-fruit');
                const veg3Card = document.getElementById('veg3Card');
                
                // è™•ç†æ°´æœä»»å‹™
                if (currentDay === 'monday' || currentDay === 'friday') {
                    // é€±ä¸€å’Œé€±äº”åªé¡¯ç¤ºä¸€å€‹äºº
                    secondFruit.style.display = 'none';
                    fruitContainer.classList.remove('grid', 'grid-cols-2', 'gap-2');
                } else {
                    // å…¶ä»–æ—¥å­é¡¯ç¤ºå…©å€‹äºº
                    secondFruit.style.display = 'block';
                    fruitContainer.classList.add('grid', 'grid-cols-2', 'gap-2');
                }
                
                // è™•ç†èœ(ä¸‰)ä»»å‹™
                if (currentDay === 'wednesday') {
                    // é€±ä¸‰ä¸é¡¯ç¤ºèœ(ä¸‰)
                    veg3Card.style.display = 'none';
                } else {
                    // å…¶ä»–æ—¥å­é¡¯ç¤ºèœ(ä¸‰)
                    veg3Card.style.display = 'block';
                }
            }
            
            // æ›´æ–°ç•¶å‰æ—¥æœŸçš„åˆ†é…
            function updateCurrentDayAssignments() {
                // æ¸…é™¤ç•¶å‰åˆ†é…
                resetSelection();
                
                // å¦‚æœç•¶å‰æ—¥æœŸæœ‰æ•¸æ“šï¼Œå‰‡é¡¯ç¤º
                if (weeklyData[currentDay]) {
                    const tasks = ['rice', 'veg1', 'veg2', 'veg3', 'soup', 'fruit'];
                    
                    tasks.forEach(task => {
                        if (weeklyData[currentDay][task]) {
                            const taskElement = document.querySelector(`.selected-students[data-task="${task}"]`);
                            if (!taskElement) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œè·³é
                            
                            // å¦‚æœä»»å‹™å¡ç‰‡è¢«éš±è—ï¼Œè·³é
                            if (task === 'veg3' && currentDay === 'wednesday') return;
                            
                            const numberElements = taskElement.querySelectorAll('.task-number');
                            
                            weeklyData[currentDay][task].forEach((num, index) => {
                                if (index < numberElements.length) {
                                    // å¦‚æœæ˜¯é€±ä¸€æˆ–é€±äº”çš„æ°´æœä¸”æ˜¯ç¬¬äºŒå€‹æ¡†ï¼Œè·³é
                                    if (task === 'fruit' && (currentDay === 'monday' || currentDay === 'friday') && index === 1) return;
                                    
                                    numberElements[index].textContent = num;
                                    assignedStudents.add(parseInt(num));
                                }
                            });
                        }
                    });
                    
                    // æ›´æ–°è™Ÿç¢¼æŒ‰éˆ•ç‹€æ…‹
                    updateNumberButtons();
                }
            }
            
            // åˆå§‹åŒ–æŠ½é¸æŒ‰éˆ•
            document.querySelectorAll('.spin-button').forEach(button => {
                button.addEventListener('click', function() {
                    const task = this.getAttribute('data-task');
                    
                    // å¦‚æœæ˜¯é€±ä¸‰çš„èœ(ä¸‰)ï¼Œä¸åŸ·è¡ŒæŠ½é¸
                    if (task === 'veg3' && currentDay === 'wednesday') return;
                    
                    spinForTask(task);
                });
            });
            
            // æ¸…é™¤é¸æ“‡æŒ‰éˆ•
            document.getElementById('clearSelectionBtn').addEventListener('click', function() {
                includedStudents.clear();
                updateNumberButtons();
                updateSelectedCount();
            });
            
            // é‡ç½®æŒ‰éˆ•
            document.getElementById('resetBtn').addEventListener('click', function() {
                resetSelection();
            });
            
            // ä¸€éµæŠ½é¸å…¨éƒ¨
            document.getElementById('spinAllBtn').addEventListener('click', function() {
                if (includedStudents.size !== requiredStudents) {
                    alert(`è«‹é¸æ“‡å‰›å¥½ ${requiredStudents} å€‹å­¸ç”Ÿè™Ÿç¢¼ï¼ç›®å‰å·²é¸ ${includedStudents.size} å€‹ã€‚`);
                    return;
                }
                
                // é‡ç½®æ‰€æœ‰åˆ†é…
                resetSelection();
                
                // å¾é¸ä¸­çš„å­¸ç”Ÿä¸­éš¨æ©Ÿåˆ†é…
                const selectedNumbers = Array.from(includedStudents);
                // æ‰“äº‚é †åº
                shuffleArray(selectedNumbers);
                
                // åˆ†é…åˆ°å„å€‹ä»»å‹™
                let tasks = ['rice', 'veg1', 'veg2', 'veg3', 'soup', 'fruit'];
                
                // å¦‚æœæ˜¯é€±ä¸‰ï¼Œç§»é™¤èœ(ä¸‰)ä»»å‹™
                if (currentDay === 'wednesday') {
                    tasks = tasks.filter(task => task !== 'veg3');
                }
                
                let currentIndex = 0;
                
                // ç‚ºæ¯å€‹ä»»å‹™åˆ†é…å­¸ç”Ÿ
                tasks.forEach(task => {
                    const taskElement = document.querySelector(`.selected-students[data-task="${task}"]`);
                    if (!taskElement) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œè·³é
                    
                    const numberElements = taskElement.querySelectorAll('.task-number');
                    
                    // ç¢ºå®šè¦åˆ†é…çš„å­¸ç”Ÿæ•¸é‡
                    let studentsToAssign = 2; // é»˜èªæ¯å€‹ä»»å‹™åˆ†é…2å€‹å­¸ç”Ÿ
                    
                    // å¦‚æœæ˜¯é€±ä¸€æˆ–é€±äº”çš„æ°´æœï¼Œåªåˆ†é…1å€‹å­¸ç”Ÿ
                    if (task === 'fruit' && (currentDay === 'monday' || currentDay === 'friday')) {
                        studentsToAssign = 1;
                    }
                    
                    for (let i = 0; i < studentsToAssign; i++) {
                        if (currentIndex < selectedNumbers.length && i < numberElements.length) {
                            // å¦‚æœæ˜¯é€±ä¸€æˆ–é€±äº”çš„æ°´æœä¸”æ˜¯ç¬¬äºŒå€‹æ¡†ï¼Œè·³é
                            if (task === 'fruit' && (currentDay === 'monday' || currentDay === 'friday') && i === 1) continue;
                            
                            const num = selectedNumbers[currentIndex];
                            numberElements[i].textContent = num;
                            assignedStudents.add(num);
                            currentIndex++;
                        }
                    }
                });
                
                // æ›´æ–°è™Ÿç¢¼æŒ‰éˆ•ç‹€æ…‹
                updateNumberButtons();
                
                // æ·»åŠ å‹•ç•«æ•ˆæœ
                document.querySelectorAll('.task-number').forEach(element => {
                    if (element.parentElement.style.display === 'none') return;
                    
                    element.parentElement.classList.add('animate-pulse');
                    setTimeout(() => {
                        element.parentElement.classList.remove('animate-pulse');
                    }, 500);
                });
                
                // é¡¯ç¤ºæ…¶ç¥æ•ˆæœ
                showConfetti();
            });
            
            // å„²å­˜æœ¬é€±å€¼æ—¥è¡¨
            document.getElementById('saveWeeklyBtn').addEventListener('click', function() {
                const tasks = ['rice', 'veg1', 'veg2', 'veg3', 'soup', 'fruit'];
                
                // æ¸…é™¤ç•¶å‰æ—¥æœŸçš„æ•¸æ“š
                weeklyData[currentDay] = {};
                
                tasks.forEach(task => {
                    // å¦‚æœæ˜¯é€±ä¸‰çš„èœ(ä¸‰)ï¼Œè·³é
                    if (task === 'veg3' && currentDay === 'wednesday') return;
                    
                    const taskElement = document.querySelector(`.selected-students[data-task="${task}"]`);
                    if (!taskElement) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œè·³é
                    
                    const numberElements = taskElement.querySelectorAll('.task-number');
                    const selectedNumbers = [];
                    
                    // ç‰¹æ®Šè™•ç†é€±ä¸€å’Œé€±äº”çš„æ°´æœä»»å‹™
                    if (task === 'fruit' && (currentDay === 'monday' || currentDay === 'friday')) {
                        // åªå–ç¬¬ä¸€å€‹è™Ÿç¢¼
                        const firstNum = numberElements[0].textContent;
                        if (firstNum !== '?' && firstNum !== '') {
                            selectedNumbers.push(firstNum);
                        }
                    } else {
                        // å…¶ä»–ä»»å‹™æˆ–å…¶ä»–æ—¥æœŸçš„æ°´æœä»»å‹™ï¼Œå–æ‰€æœ‰è™Ÿç¢¼
                        numberElements.forEach(element => {
                            if (element.parentElement.style.display !== 'none') {
                                const num = element.textContent;
                                if (num !== '?' && num !== '') {
                                    selectedNumbers.push(num);
                                }
                            }
                        });
                    }
                    
                    if (selectedNumbers.length > 0) {
                        weeklyData[currentDay][task] = selectedNumbers;
                    }
                });
                
                updateWeeklyTable();
                showConfetti();
                
                // å„²å­˜åˆ° localStorage
                localStorage.setItem('weeklyData', JSON.stringify(weeklyData));
            });
            
            // ç”Ÿæˆè™Ÿç¢¼æŒ‰éˆ•
            function generateNumberButtons(container) {
                container.innerHTML = '';
                
                for (let i = 1; i <= totalStudents; i++) {
                    const btn = document.createElement('div');
                    btn.className = 'number-btn bg-gray-100 text-gray-800';
                    btn.textContent = i;
                    btn.dataset.number = i;
                    
                    if (includedStudents.has(i)) {
                        btn.classList.add('selected');
                    }
                    
                    if (assignedStudents.has(i)) {
                        btn.classList.add('used');
                    }
                    
                    btn.addEventListener('click', function() {
                        const num = parseInt(this.dataset.number);
                        
                        // åˆ‡æ›é¸æ“‡ç‹€æ…‹
                        if (includedStudents.has(num)) {
                            includedStudents.delete(num);
                            this.classList.remove('selected');
                        } else {
                            // å¦‚æœå·²ç¶“é¸æ»¿äº†ï¼Œä¸èƒ½å†é¸
                            if (includedStudents.size >= requiredStudents) {
                                alert(`æœ€å¤šåªèƒ½é¸æ“‡ ${requiredStudents} å€‹å­¸ç”Ÿï¼`);
                                return;
                            }
                            includedStudents.add(num);
                            this.classList.add('selected');
                        }
                        
                        updateSelectedCount();
                    });
                    
                    container.appendChild(btn);
                }
            }
            
            // æ›´æ–°è™Ÿç¢¼æŒ‰éˆ•ç‹€æ…‹
            function updateNumberButtons() {
                document.querySelectorAll('#numberSelector .number-btn').forEach(btn => {
                    const num = parseInt(btn.dataset.number);
                    
                    // é‡ç½®æ‰€æœ‰æŒ‰éˆ•ç‹€æ…‹
                    btn.classList.remove('selected', 'used');
                    
                    // è¨­ç½®é¸ä¸­ç‹€æ…‹
                    if (includedStudents.has(num)) {
                        btn.classList.add('selected');
                    }
                    
                    // è¨­ç½®å·²ä½¿ç”¨ç‹€æ…‹
                    if (assignedStudents.has(num)) {
                        btn.classList.add('used');
                    }
                });
            }
            
            // å¾ localStorage è¼‰å…¥è³‡æ–™
            function loadSavedData() {
                const savedData = localStorage.getItem('weeklyData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        Object.assign(weeklyData, parsedData);
                        updateWeeklyTable();
                        updateCurrentDayAssignments();
                        updateTasksDisplay();
                        updateRequiredStudents();
                    } catch (e) {
                        console.error('Error loading saved data:', e);
                    }
                } else {
                    updateTasksDisplay();
                    updateRequiredStudents();
                }
            }
            
            // æ›´æ–°é€±è¡¨
            function updateWeeklyTable() {
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
                const tasks = ['rice', 'veg1', 'veg2', 'veg3', 'soup', 'fruit'];
                
                const rows = document.querySelectorAll('#weeklyTable tr');
                
                // å…ˆæ¸…é™¤æ‰€æœ‰é«˜äº®
                document.querySelectorAll('#weeklyTable td').forEach(cell => {
                    cell.classList.remove('bg-yellow-100');
                });
                
                tasks.forEach((task, taskIndex) => {
                    days.forEach((day, dayIndex) => {
                        // å¦‚æœæ˜¯é€±ä¸‰çš„èœ(ä¸‰)ï¼Œé¡¯ç¤ºç‚º"ä¸é©ç”¨"
                        if (task === 'veg3' && day === 'wednesday') {
                            const cell = rows[taskIndex].cells[dayIndex + 1];
                            cell.textContent = "ä¸é©ç”¨";
                            cell.classList.add('text-gray-500', 'italic');
                            
                            // é«˜äº®ç•¶å‰é¸ä¸­çš„æ˜ŸæœŸ
                            if (day === currentDay) {
                                cell.classList.add('bg-yellow-100');
                            }
                            return;
                        }
                        
                        if (weeklyData[day] && weeklyData[day][task]) {
                            const cell = rows[taskIndex].cells[dayIndex + 1];
                            cell.textContent = weeklyData[day][task].join(', ');
                            cell.classList.remove('text-gray-500', 'italic');
                            
                            // é«˜äº®ç•¶å‰é¸ä¸­çš„æ˜ŸæœŸ
                            if (day === currentDay) {
                                cell.classList.add('bg-yellow-100');
                            }
                        } else {
                            // æ¸…ç©ºæ²’æœ‰æ•¸æ“šçš„å–®å…ƒæ ¼
                            const cell = rows[taskIndex].cells[dayIndex + 1];
                            cell.textContent = '';
                            cell.classList.remove('text-gray-500', 'italic');
                            
                            // é«˜äº®ç•¶å‰é¸ä¸­çš„æ˜ŸæœŸ
                            if (day === currentDay) {
                                cell.classList.add('bg-yellow-100');
                            }
                        }
                    });
                });
            }
            
            // ç‚ºç‰¹å®šä»»å‹™æŠ½é¸å­¸ç”Ÿ
            function spinForTask(task) {
                if (includedStudents.size !== requiredStudents) {
                    alert(`è«‹é¸æ“‡å‰›å¥½ ${requiredStudents} å€‹å­¸ç”Ÿè™Ÿç¢¼ï¼ç›®å‰å·²é¸ ${includedStudents.size} å€‹ã€‚`);
                    return;
                }
                
                // å¦‚æœæ˜¯é€±ä¸‰çš„èœ(ä¸‰)ï¼Œä¸åŸ·è¡ŒæŠ½é¸
                if (task === 'veg3' && currentDay === 'wednesday') return;
                
                const taskElement = document.querySelector(`.selected-students[data-task="${task}"]`);
                if (!taskElement) return; // å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œè·³é
                
                const numberElements = taskElement.querySelectorAll('.task-number');
                
                // ç¢ºå®šè¦åˆ†é…çš„å­¸ç”Ÿæ•¸é‡
                let studentsToAssign = 2; // é»˜èªåˆ†é…2å€‹å­¸ç”Ÿ
                
                // å¦‚æœæ˜¯é€±ä¸€æˆ–é€±äº”çš„æ°´æœï¼Œåªåˆ†é…1å€‹å­¸ç”Ÿ
                if (task === 'fruit' && (currentDay === 'monday' || currentDay === 'friday')) {
                    studentsToAssign = 1;
                }
                
                // ç²å–é¸ä¸­çš„è™Ÿç¢¼ï¼ˆæ’é™¤å·²åˆ†é…çš„è™Ÿç¢¼ï¼‰
                const availableForSelection = Array.from(includedStudents).filter(num => 
                    !assignedStudents.has(num)
                );
                
                // å¦‚æœå¯ç”¨è™Ÿç¢¼ä¸è¶³ï¼Œé¡¯ç¤ºè­¦å‘Š
                if (availableForSelection.length < studentsToAssign) {
                    alert(`å¯ç”¨è™Ÿç¢¼ä¸è¶³ï¼éœ€è¦ ${studentsToAssign} å€‹è™Ÿç¢¼ï¼Œä½†åªæœ‰ ${availableForSelection.length} å€‹å¯ç”¨ã€‚`);
                    return;
                }
                
                // æ¸…é™¤ä¹‹å‰çš„é¸æ“‡
                numberElements.forEach(element => {
                    if (element.parentElement.style.display === 'none') return;
                    
                    const currentNum = element.textContent;
                    if (currentNum !== '?' && currentNum !== '') {
                        assignedStudents.delete(parseInt(currentNum));
                    }
                    element.textContent = '?';
                });
                
                // å‹•ç•«æ•ˆæœ
                let counter = 0;
                const maxIterations = 20;
                const interval = setInterval(() => {
                    // ç‚ºäº†å‹•ç•«æ•ˆæœï¼Œæˆ‘å€‘éœ€è¦ç¢ºä¿æ¯æ¬¡é¡¯ç¤ºçš„è™Ÿç¢¼ä¸åŒ
                    const tempNumbers = [...availableForSelection];
                    shuffleArray(tempNumbers);
                    
                    for (let i = 0; i < studentsToAssign; i++) {
                        if (i < numberElements.length && tempNumbers[i] && numberElements[i].parentElement.style.display !== 'none') {
                            numberElements[i].textContent = tempNumbers[i];
                        }
                    }
                    
                    counter++;
                    if (counter >= maxIterations) {
                        clearInterval(interval);
                        
                        // æœ€çµ‚é¸æ“‡
                        const finalNumbers = [];
                        const tempAvailable = [...availableForSelection];
                        shuffleArray(tempAvailable);
                        
                        for (let i = 0; i < studentsToAssign; i++) {
                            if (i < numberElements.length && tempAvailable[i] && numberElements[i].parentElement.style.display !== 'none') {
                                const finalNum = tempAvailable[i];
                                finalNumbers.push(finalNum);
                                numberElements[i].textContent = finalNum;
                                assignedStudents.add(finalNum);
                            }
                        }
                        
                        // æ›´æ–°è™Ÿç¢¼æŒ‰éˆ•ç‹€æ…‹
                        updateNumberButtons();
                        
                        // æ·»åŠ å‹•ç•«æ•ˆæœ
                        for (let i = 0; i < studentsToAssign; i++) {
                            if (i < numberElements.length && numberElements[i].parentElement.style.display !== 'none') {
                                numberElements[i].parentElement.classList.add('animate-pulse');
                                setTimeout(() => {
                                    numberElements[i].parentElement.classList.remove('animate-pulse');
                                }, 500);
                            }
                        }
                    }
                }, 100);
            }
            
            // é‡ç½®é¸æ“‡
            function resetSelection() {
                assignedStudents.clear();
                document.querySelectorAll('.task-number').forEach(element => {
                    element.textContent = '?';
                });
                updateNumberButtons();
            }
            
            // æ‰“äº‚æ•¸çµ„é †åº
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // é¡¯ç¤ºæ…¶ç¥æ•ˆæœ
            function showConfetti() {
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = -10 + 'px';
                    document.body.appendChild(confetti);
                    
                    const size = Math.random() * 10 + 5;
                    confetti.style.width = size + 'px';
                    confetti.style.height = size + 'px';
                    
                    const duration = Math.random() * 3 + 2;
                    confetti.style.animation = `fall ${duration}s linear forwards`;
                    
                    // è‡ªå®šç¾©å‹•ç•«
                    const keyframes = `
                        @keyframes fall {
                            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                            100% { transform: translateY(${Math.random() * 500 + 500}px) rotate(${Math.random() * 360}deg); opacity: 0; }
                        }
                    `;
                    
                    const style = document.createElement('style');
                    style.innerHTML = keyframes;
                    document.head.appendChild(style);
                    
                    // ç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        confetti.remove();
                        style.remove();
                    }, duration * 1000);
                }
            }
            
            // è®“ä»»å‹™å¡ç‰‡ä¸­çš„è™Ÿç¢¼å¯é»æ“Š
            document.querySelectorAll('.number-box').forEach(box => {
                box.addEventListener('click', function() {
                    // å¦‚æœé€™å€‹å…ƒç´ è¢«éš±è—ï¼Œä¸è™•ç†é»æ“Šäº‹ä»¶
                    if (this.style.display === 'none') return;
                    
                    const taskNumber = this.querySelector('.task-number');
                    const currentNumber = taskNumber.textContent;
                    
                    // å¦‚æœå·²ç¶“æœ‰è™Ÿç¢¼ï¼Œå…ˆå¾å·²é¸æ“‡é›†åˆä¸­ç§»é™¤
                    if (currentNumber !== '?' && currentNumber !== '') {
                        assignedStudents.delete(parseInt(currentNumber));
                    }
                    
                    // æ‰“é–‹å­¸ç”Ÿé¸æ“‡å°è©±æ¡†
                    openStudentSelectModal(number => {
                        if (number) {
                            taskNumber.textContent = number;
                            assignedStudents.add(parseInt(number));
                        } else {
                            taskNumber.textContent = '?';
                        }
                        updateNumberButtons();
                    });
                });
            });
            
            // æ‰“é–‹å­¸ç”Ÿé¸æ“‡å°è©±æ¡†
            function openStudentSelectModal(callback) {
                const modal = document.getElementById('studentSelectModal');
                const modalSelector = modal.querySelector('.number-selector-modal');
                let selectedNumber = null;
                
                // ç”Ÿæˆè™Ÿç¢¼æŒ‰éˆ•
                modalSelector.innerHTML = '';
                
                // åªé¡¯ç¤ºå·²é¸ä¸­çš„å­¸ç”Ÿè™Ÿç¢¼
                Array.from(includedStudents).sort((a, b) => a - b).forEach(i => {
                    const btn = document.createElement('div');
                    btn.className = 'number-btn bg-gray-100 text-gray-800';
                    btn.textContent = i;
                    
                    // å¦‚æœå·²ç¶“è¢«åˆ†é…ï¼Œæ¨™è¨˜ç‚ºå·²ä½¿ç”¨
                    if (assignedStudents.has(i)) {
                        btn.classList.add('used');
                    } else {
                        btn.addEventListener('click', function() {
                            // ç§»é™¤ä¹‹å‰çš„é¸æ“‡
                            modalSelector.querySelectorAll('.number-btn').forEach(b => {
                                b.classList.remove('selected');
                            });
                            
                            // é¸æ“‡ç•¶å‰è™Ÿç¢¼
                            this.classList.add('selected');
                            selectedNumber = i;
                        });
                    }
                    
                    modalSelector.appendChild(btn);
                });
                
                // é¡¯ç¤ºå°è©±æ¡†
                modal.classList.remove('hidden');
                
                // ç¢ºèªæŒ‰éˆ•
                const confirmBtn = document.getElementById('confirmSelectBtn');
                confirmBtn.onclick = function() {
                    modal.classList.add('hidden');
                    callback(selectedNumber);
                };
                
                // å–æ¶ˆæŒ‰éˆ•
                const cancelBtn = document.getElementById('cancelSelectBtn');
                cancelBtn.onclick = function() {
                    modal.classList.add('hidden');
                    callback(null);
                };
            }
            
            // è¼‰å…¥å·²å„²å­˜çš„è³‡æ–™
            loadSavedData();
            updateSelectedCount();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93cf6fb127184a15',t:'MTc0Njc3NTI0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
